export default class Neysla{_config=null;constructor(){this._config=null}init(e){if(this._config=e,!this._validate())return!1;const s=this._createModelers();return new Promise(e=>e(s))}_validate(){let e=!0;if(this._config instanceof Object||this._config instanceof Array?this._config instanceof Array&&!this._config.length&&(console.error("Neysla: Array of initializators is empty."),e=!1):(console.error("Neysla: You must set an Array or an Object to initializate your modelers."),e=!1),!e||this._config instanceof Array||(this._config=[this._config]),e)for(var s in this._config)this._config.hasOwnProperty(s)&&(this._config[s].name&&"string"==typeof this._config[s].name?"string"!=typeof this._config[s].url?(console.error(`Neysla: Initializator with name ${this._config[s].name} has no properly defined url.`),e=!1):this._config[s].headers&&("object"!=typeof this._config[s].headers||this._config[s].headers instanceof Array)?(console.error(`Neysla: Initializator with name ${this._config[s].name} has no properly defined headers.`),e=!1):this._config[s].params&&("object"!=typeof this._config[s].params||this._config[s].params instanceof Array)?(console.error(`Neysla: Initializator with name ${this._config[s].name} has no properly defined params.`),e=!1):this._config[s].requestType&&"string"!=typeof this._config[s].requestType?(console.error(`Neysla: Initializator with name ${this._config[s].name} has no properly defined requestType.`),e=!1):this._config[s].responseType&&"string"!=typeof this._config[s].responseType?(console.error(`Neysla: Initializator with name ${this._config[s].name} has no properly defined responseType.`),e=!1):this._config[s].body&&("object"!=typeof this._config[s].body||this._config[s].body instanceof Array)&&(console.error(`Neysla: Initializator with name ${this._config[s].name} has no properly defined body.`),e=!1):(console.error(`Neysla: Initializator with index ${s} has no properly defined name.`),e=!1));return e}_createModelers(){var e={};for(const s of this._config)e[s.name]=new ModelerBuilder(s);return e}static get(e={}){return this._setRequest(e,"GET")}static head(e={}){return this._setRequest(e,"HEAD")}static post(e={}){return this._setRequest(e,"POST",!0)}static patch(e={}){return this._setRequest(e,"PATCH",!0)}static put(e={}){return this._setRequest(e,"PUT",!0)}static remove(e={}){return this._setRequest(e,"DELETE",!0)}static _setRequest(e,s,t=!1){var r,n;return e instanceof Object?(t=t?this._setBody(e.body,e.requestType):null,r=this._setRequestType(e.requestType),n=e.responseType&&"string"==typeof e.responseType?e.responseType:"json",e.headers instanceof Object||(e.headers={}),e.progress instanceof Function||(e.progress=function(){}),this._executeRequest({method:s,body:t,requestType:r,responseType:n,headers:e.headers,progress:e.progress,url:e.url})):(console.error("Neysla: The configuration must be an object."),!1)}static _setBody(s,e){let t=null;if(s instanceof FormData&&"multipart"===e)t=s;else if(s instanceof Object)switch(e){case"json":t=JSON.stringify(s);break;case"multipart":t=new FormData,Object.keys(s).forEach(e=>t.append(e,s[e]));break;default:t="",Object.keys(s).forEach(e=>t+=(""!==t?"&":"")+e+"="+s[e])}return t}static _setRequestType(e){let s;switch(e){case"json":s="application/json";break;case"multipart":s=null;break;default:s="application/x-www-form-urlencoded"}return s}static _executeRequest(r){return r.url&&"string"==typeof r.url?new Promise((e,s)=>{const t=new XMLHttpRequest;t.addEventListener("progress",r.progress),t.addEventListener("abort",()=>this._handleResponse(t,e,s,r.url,r.responseType,!0)),t.addEventListener("error",()=>this._handleResponse(t,e,s,r.url,r.responseType,!0)),t.addEventListener("load",()=>this._handleResponse(t,e,s,r.url,r.responseType)),t.open(r.method,r.url,!0),t.responseType=r.responseType,r.requestType&&t.setRequestHeader("Content-Type",r.requestType),Object.keys(r.headers).forEach(e=>{t.setRequestHeader(e,r.headers[e])}),t.send(r.body)}):(console.error("Neysla: Request has no properly defined url."),!1)}static _handleResponse(s,e,t,r,n,o=!1){var i,a={headers:{},status:s.status,statusText:s.statusText,getHeader:e=>s.getResponseHeader(e),data:o||"json"!==n||"string"!=typeof s.response?s.response:JSON.parse(s.response),dataType:s.responseType,url:r};for(const l of s.getAllResponseHeaders().split("\r\n"))""!==l&&(i=l.split(":"),a.headers[i[0]]=i[1].trim());(300<=s.status||0===s.status||o?t:e)(a)}}class ModelerBuilder{_config=null;constructor(e){this.config=e}setModel(e){return e instanceof Array||"string"==typeof e?new ModelBuilder(this.config,e):(console.error(`Neysla: A model's name of ${this.config.name} modeler is not properly defined.`),!1)}}class ModelBuilder{_modelerName=null;_url=null;_params=null;_headers=null;_requestType=null;_responseType=null;_body=null;_name=null;constructor(e,s){this._modelerName=e.name,this._url=e.url,this._params=e.params instanceof Object&&Object.keys(e.params).length?e.params:null,this._headers=e.headers instanceof Object&&Object.keys(e.headers).length?e.headers:null,this._requestType=e.requestType&&"string"==typeof e.requestType?e.requestType:null,this._responseType=e.responseType&&"string"==typeof e.responseType?e.responseType:null,this._body=e.body instanceof Object&&Object.keys(e.body).length?e.body:null,this._name=s}get(e={}){return this._setRequest(e,"GET")}head(e={}){return this._setRequest(e,"HEAD")}post(e={}){return this._setRequest(e,"POST",!0)}patch(e={}){return this._setRequest(e,"PATCH",!0)}put(e={}){return this._setRequest(e,"PUT",!0)}remove(e={}){return this._setRequest(e,"DELETE",!0)}_setRequest(e,s,t=!1){if(!(e instanceof Object))return console.error("Neysla: The model's configuration must be an object."),!1;if(e.delimiters&&!(e.delimiters instanceof Array||"string"==typeof e.delimiters||"number"==typeof e.delimiters))return console.error("Neysla: The model's delimiters are not properly defined."),!1;var r=this._setUrl(e.delimiters);if(!1===r)return r;r+=this._setParams(e.params);var n=this._setHeaders(e.headers),t=t?this._setBody(e.body,e.requestType||this._requestType):null,o=this._setRequestType(e.requestType),i="string"==typeof e.responseType?e.responseType:"string"==typeof this._responseType?this._responseType:"json";return e.progress instanceof Function||(e.progress=function(){}),this._executeRequest({method:s,url:r,headers:n,body:t,requestType:o,responseType:i,progress:e.progress})}_setUrl(e){if(e=!e||e instanceof Array?e||[]:[e],"string"==typeof this._name&&(this._name=[this._name]),this._name.length!==e.length&&this._name.length-1!==e.length)return console.error("Neysla: Incorrect relation between name and delimiters."),!1;let s="";for(var t in this._name)s+=""+this._name[t]+(e[t]?"/"+e[t]:"")+(parseInt(t,10)===this._name.length-1?"":"/");return this._url+s}_setParams(e){let t="",r=null;return this._params instanceof Object&&(r={...this._params}),(r=e instanceof Object?{...r,...e}:r)instanceof Object&&Object.keys(r).forEach((e,s)=>{t+=(0!==s?"&":"?")+e+"="+r[e]}),t}_setHeaders(e){let s={};return this._headers instanceof Object&&(s={...this._headers}),s=e instanceof Object?{...s,...e}:s}_setRequestType(e=this._requestType){let s;switch(e){case"json":s="application/json";break;case"multipart":s=null;break;default:s="application/x-www-form-urlencoded"}return s}_setBody(e,t){let r=null;if(e instanceof FormData&&"multipart"===t){if(r=e,this._body instanceof Object)for(const s in this._body)r.append(s,this._body[s])}else{let s=null;if(this._body instanceof Object&&e instanceof Object?s={...this._body,...e}:e instanceof Object?s={...e}:this._body instanceof Object&&(s={...this._body}),s instanceof Object)switch(t){case"json":r=JSON.stringify(s);break;case"multipart":r=new FormData,Object.keys(s).forEach(e=>r.append(e,s[e]));break;default:r="",Object.keys(s).forEach(e=>r+=(""!==r?"&":"")+e+"="+s[e])}}return r}_executeRequest(n){return new Promise((e,s)=>{const t=new XMLHttpRequest;for(var r in t.addEventListener("progress",n.progress),t.addEventListener("abort",()=>this._handleResponse(t,e,s,n.url,n.responseType,!0)),t.addEventListener("error",()=>this._handleResponse(t,e,s,n.url,n.responseType,!0)),t.addEventListener("load",()=>this._handleResponse(t,e,s,n.url,n.responseType)),t.open(n.method,n.url,!0),t.responseType=n.responseType,n.requestType&&t.setRequestHeader("Content-Type",n.requestType),n.headers)n.headers.hasOwnProperty(r)&&t.setRequestHeader(r,n.headers[r]);t.send(n.body)})}_handleResponse(s,e,t,r,n,o=!1){var i,a={headers:{},status:s.status,statusText:s.statusText,getHeader:e=>s.getResponseHeader(e),data:o||"json"!==n||"string"!=typeof s.response?s.response:JSON.parse(s.response),dataType:s.responseType,url:r};for(const l of s.getAllResponseHeaders().split("\r\n"))""!==l&&(i=l.split(":"),a.headers[i[0]]=i[1].trim());(300<=s.status||0===s.status||o?t:e)(a)}}